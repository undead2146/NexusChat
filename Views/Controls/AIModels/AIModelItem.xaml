<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:NexusChat.Core.ViewModels"
             xmlns:models="clr-namespace:NexusChat.Core.Models"
             xmlns:converters="clr-namespace:NexusChat.Views.Converters"
             x:Class="NexusChat.Views.Controls.AIModelItem"
             x:Name="AIModelItemRoot"
             x:DataType="models:AIModel">

    <ContentView.Resources>
        <ResourceDictionary>
            <converters:ProviderToColorConverter x:Key="ProviderToColorConverter" />
            <converters:StarColorConverter x:Key="StarColorConverter" />
            <converters:ModelStatusToColorConverter x:Key="ModelStatusToColorConverter" />
            <converters:ModelStatusToStrokeThicknessConverter x:Key="ModelStatusToStrokeThicknessConverter" />
            <converters:BoolToColorConverter x:Key="BoolToColorConverter" />
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        </ResourceDictionary>
    </ContentView.Resources>

    <Border BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#2D2D2D}"
           StrokeShape="RoundRectangle 12,12,12,12"
           Stroke="{Binding ., Converter={StaticResource ModelStatusToColorConverter}}"
           StrokeThickness="{Binding ., Converter={StaticResource ModelStatusToStrokeThicknessConverter}}"
           Padding="16"
           Margin="8,4">
        
        <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*,Auto" RowSpacing="8">
            
            <!-- Header Row with Provider and Status Icons -->
            <Grid Grid.Row="0" Grid.ColumnSpan="2" ColumnDefinitions="Auto,*,Auto,Auto,Auto">
                
                <!-- Provider Badge -->
                <Border Grid.Column="0"
                       BackgroundColor="{Binding ProviderName, Converter={StaticResource ProviderToColorConverter}}"
                       StrokeShape="RoundRectangle 12,12,12,12"
                       Padding="8,4">
                    <Label Text="{Binding ProviderName}"
                           TextColor="White"
                           FontSize="12"
                           FontAttributes="Bold" />
                </Border>
                
                <!-- Status Icons -->
                <StackLayout Grid.Column="2" Orientation="Horizontal" Spacing="4">
                    <!-- Selected Indicator -->
                    <Label Text="&#xf00c;"
                           FontFamily="FontAwesome-Solid"
                           TextColor="Blue"
                           FontSize="14"
                           IsVisible="{Binding IsSelected}"
                           ToolTipProperties.Text="Currently Selected" />
                    
                    <!-- Default Indicator -->
                    <Label Text="&#xf015;"
                           FontFamily="FontAwesome-Solid"
                           TextColor="Green"
                           FontSize="14"
                           IsVisible="{Binding IsDefault}"
                           ToolTipProperties.Text="Default Model" />
                    
                    <!-- Favorite Indicator -->
                    <Label Text="&#xf005;"
                           FontFamily="FontAwesome-Solid"
                           TextColor="Gold"
                           FontSize="14"
                           IsVisible="{Binding IsFavorite}"
                           ToolTipProperties.Text="Favorite Model" />
                </StackLayout>
                
                <!-- Action Buttons -->
                <StackLayout Grid.Column="3" Orientation="Horizontal" Spacing="4">
                    <!-- Favorite Toggle Button -->
                    <Button Text="{Binding IsFavorite, Converter={StaticResource StarColorConverter}, ConverterParameter='Icon'}"
                            FontFamily="FontAwesome-Solid"
                            TextColor="{Binding IsFavorite, Converter={StaticResource StarColorConverter}}"
                            BackgroundColor="Transparent"
                            BorderColor="Transparent"
                            FontSize="16"
                            WidthRequest="36"
                            HeightRequest="36"
                            Padding="0"
                            Command="{Binding Source={x:Reference AIModelItemRoot}, Path=ToggleFavoriteCommand}"
                            CommandParameter="{Binding}"
                            ToolTipProperties.Text="Toggle Favorite" />
                    
                    <!-- Set Default Button -->
                    <Button Text="&#xf015;"
                            FontFamily="FontAwesome-Solid"
                            TextColor="{Binding IsDefault, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Green|Gray'}"
                            BackgroundColor="Transparent"
                            BorderColor="Transparent"
                            FontSize="16"
                            WidthRequest="36"
                            HeightRequest="36"
                            Padding="0"
                            Command="{Binding Source={x:Reference AIModelItemRoot}, Path=SetDefaultModelCommand}"
                            CommandParameter="{Binding}"
                            ToolTipProperties.Text="Set as Default" />
                </StackLayout>
                
                <!-- Menu Button -->
                <Button Grid.Column="4"
                        Text="&#xf142;"
                        FontFamily="FontAwesome-Solid"
                        TextColor="{AppThemeBinding Light=#666666, Dark=#cccccc}"
                        BackgroundColor="Transparent"
                        BorderColor="Transparent"
                        FontSize="16"
                        WidthRequest="36"
                        HeightRequest="36"
                        Padding="0"
                        Command="{Binding Source={x:Reference AIModelItemRoot}, Path=ShowModelInfoCommand}"
                        CommandParameter="{Binding}"
                        ToolTipProperties.Text="Model Info" />
            </Grid>
            
            <!-- Model Name Row -->
            <Label Grid.Row="1" Grid.ColumnSpan="2"
                   Text="{Binding ModelName}"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#333333, Dark=#ffffff}"
                   LineBreakMode="TailTruncation" />
            
            <!-- Description Row -->
            <Label Grid.Row="2" Grid.ColumnSpan="2"
                   Text="{Binding Description}"
                   FontSize="14"
                   TextColor="{AppThemeBinding Light=#666666, Dark=#cccccc}"
                   LineBreakMode="WordWrap"
                   MaxLines="2"
                   IsVisible="{Binding Description, Converter={StaticResource StringEmptyConverter}, ConverterParameter='Invert'}" />
            
            <!-- Model Details and Select Button Row -->
            <Grid Grid.Row="3" Grid.ColumnSpan="2" ColumnDefinitions="*,Auto">
                
                <!-- Model Specifications -->
                <StackLayout Grid.Column="0" Orientation="Horizontal" Spacing="12">
                    <Label Text="{Binding MaxTokens, StringFormat='Max: {0:N0} tokens'}"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light=#999999, Dark=#999999}" />
                    
                    <Label Text="{Binding MaxContextWindow, StringFormat='Context: {0:N0}'}"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light=#999999, Dark=#999999}" />
                    
                    <!-- Capability Icons -->
                    <StackLayout Orientation="Horizontal" Spacing="4">
                        <Label Text="&#xf03e;"
                               FontFamily="FontAwesome-Solid"
                               FontSize="12"
                               TextColor="{Binding SupportsVision, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Green|Gray'}"
                               ToolTipProperties.Text="Vision Support"
                               IsVisible="{Binding SupportsVision}" />
                        
                        <Label Text="&#xf121;"
                               FontFamily="FontAwesome-Solid"
                               FontSize="12"
                               TextColor="{Binding SupportsCodeCompletion, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Blue|Gray'}"
                               ToolTipProperties.Text="Code Support"
                               IsVisible="{Binding SupportsCodeCompletion}" />
                        
                        <Label Text="&#xf04b;"
                               FontFamily="FontAwesome-Solid"
                               FontSize="12"
                               TextColor="{Binding SupportsStreaming, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Purple|Gray'}"
                               ToolTipProperties.Text="Streaming Support"
                               IsVisible="{Binding SupportsStreaming}" />
                    </StackLayout>
                </StackLayout>
                
                <!-- Select Button -->
                <Button Grid.Column="1"
                        Text="{Binding IsSelected, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Selected|Select'}"
                        FontSize="14"
                        FontAttributes="Bold"
                        BackgroundColor="{Binding IsSelected, Converter={StaticResource BoolToColorConverter}, ConverterParameter='#0078D7|#28a745'}"
                        TextColor="White"
                        CornerRadius="6"
                        Padding="16,8"
                        Command="{Binding Source={x:Reference AIModelItemRoot}, Path=SelectModelCommand}"
                        CommandParameter="{Binding}"
                        IsEnabled="{Binding IsSelected, Converter={StaticResource InvertedBoolConverter}}" />
            </Grid>
        </Grid>
        
        <!-- Tap Gesture for Selection -->
        <Border.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding Source={x:Reference AIModelItemRoot}, Path=SelectModelCommand}"
                                  CommandParameter="{Binding}" />
        </Border.GestureRecognizers>
    </Border>
</ContentView>
