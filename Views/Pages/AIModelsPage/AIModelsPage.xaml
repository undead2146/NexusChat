<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:NexusChat.Core.ViewModels"
             xmlns:controls="clr-namespace:NexusChat.Views.Controls"
             x:Class="NexusChat.Views.Pages.AIModelsPage"
             x:DataType="viewmodels:AIModelsViewModel"
             Title="AI Models">

    <Grid>
        <!-- Main Content -->
        <Grid RowDefinitions="Auto,*">
            <!-- Header -->
            <controls:AIModelsHeader Grid.Row="0"
                                     SearchText="{Binding SearchText}"
                                     ShowFavoritesOnly="{Binding ShowFavoritesOnly}"
                                     RefreshButtonRotation="{Binding RefreshButtonRotation}"
                                     GoBackCommand="{Binding GoBackCommand}"
                                     FilterModelsCommand="{Binding FilterModelsCommand}"
                                     ToggleFavoritesFilterCommand="{Binding ToggleFavoritesFilterCommand}"
                                     RefreshModelsCommand="{Binding RefreshModelsCommand}" />
            
            <!-- Models List -->
            <CollectionView Grid.Row="1" 
                            ItemsSource="{Binding FilteredModels}"
                            BackgroundColor="{AppThemeBinding Light=#f8f9fa, Dark=#1a1a1a}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <controls:AIModelItem SelectModelCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:AIModelsViewModel}}, Path=SelectModelCommand}"
                                              ToggleFavoriteCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:AIModelsViewModel}}, Path=ToggleFavoriteCommand}"
                                              SetDefaultModelCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:AIModelsViewModel}}, Path=SetDefaultModelCommand}"
                                              ShowModelInfoCommand="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:AIModelsViewModel}}, Path=ShowModelInfoCommand}" />
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
        
        <!-- Floating Add Button -->
        <controls:FloatingAddButton IsVisible="{Binding ShowAddButton}"
                                    Command="{Binding ShowApiKeyOverlayCommand}" />
        
        <!-- API Key Overlay -->
        <controls:ApiKeyOverlay IsVisible="{Binding IsApiKeyOverlayVisible}"
                                ExistingApiKeys="{Binding ExistingApiKeys}"
                                SaveApiKeyCommand="{Binding SaveApiKeyCommand}"
                                RemoveApiKeyCommand="{Binding RemoveApiKeyCommand}"
                                CloseOverlayCommand="{Binding CloseApiKeyOverlayCommand}" />
    </Grid>

</ContentPage>
