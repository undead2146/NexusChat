<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:NexusChat.Core.ViewModels"
             xmlns:controls="clr-namespace:NexusChat.Views.Controls"
             x:Class="NexusChat.Views.Pages.AIModelsPage"
             Title="AI Models"
             Shell.NavBarIsVisible="False"
             Shell.TabBarIsVisible="False">

    <Grid Padding="{OnPlatform iOS='0,47,0,34', Android='0,0,0,0', Default='0,0,0,0'}">
        
        <!-- Main content in background -->
        <Grid RowDefinitions="Auto,*" >
            <!-- Header -->
            <controls:AIModelsHeader Grid.Row="0"
                                    SearchText="{Binding SearchText}"
                                    ShowFavoritesOnly="{Binding ShowFavoritesOnly}"
                                    RefreshButtonRotation="{Binding RefreshButtonRotation}"
                                    GoBackCommand="{Binding GoBackCommand}"
                                    FilterModelsCommand="{Binding FilterModelsCommand}"
                                    ToggleFavoritesFilterCommand="{Binding ToggleFavoritesFilterCommand}"
                                    RefreshModelsCommand="{Binding RefreshModelsCommand}" />
            
            <!-- Models List -->
            <CollectionView Grid.Row="1"
                            x:Name="ModelsCollectionView"
                            ItemsSource="{Binding FilteredModels}"
                            BackgroundColor="{AppThemeBinding Light=#f8f9fa, Dark=#1a1a1a}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <controls:AIModelItem Model="{Binding}"
                                             ToggleFavoriteCommand="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ToggleFavoriteCommand}"
                                             SelectModelCommand="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectModelCommand}"
                                             SetDefaultModelCommand="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SetDefaultModelCommand}"
                                             ShowModelInfoCommand="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ShowModelInfoCommand}" />
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
        
        <!-- Floating Add Button as overlay -->
        <controls:FloatingAddButton Command="{Binding DisplayApiKeyOverlayCommand}"
                                   HorizontalOptions="End"
                                   VerticalOptions="End"
                                   ZIndex="1000" />
        
        <!-- API Key Overlay -->
        <controls:ApiKeyOverlay IsVisible="{Binding ShowApiKeyOverlay}"
                               ExistingApiKeys="{Binding ExistingApiKeys}"
                               SaveApiKeyCommand="{Binding SaveApiKeyCommand}"
                               RemoveApiKeyCommand="{Binding RemoveApiKeyCommand}"
                               CloseOverlayCommand="{Binding CloseApiKeyOverlayCommand}"
                               ZIndex="2000" />
        
    </Grid>

</ContentPage>
