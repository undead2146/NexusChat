<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="NexusChat.Views.Pages.MainPage"
             BackgroundColor="{AppThemeBinding Light={StaticResource Background}, Dark={StaticResource BackgroundDark}}">

    <!-- Import any needed resources here -->
    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Consistent style for icons -->
            <Style x:Key="MainPageIcon" TargetType="Label">
                <Setter Property="FontFamily" Value="FontAwesome-Solid" />
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAutoScalingEnabled" Value="False" />
                <Setter Property="HorizontalOptions" Value="Center" />
                <Setter Property="VerticalOptions" Value="Center" />
                <Setter Property="HorizontalTextAlignment" Value="Center" />
                <Setter Property="VerticalTextAlignment" Value="Center" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto" Padding="0" RowSpacing="0">

        <!-- Main Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="20">
                
                <!-- Welcome Section -->
                <Frame Padding="0" HasShadow="True" CornerRadius="12" IsClippedToBounds="True">
                    <Grid RowDefinitions="Auto,*">
                        <Image Grid.RowSpan="2" Source="dotnet_bot.png" Aspect="AspectFill"
                               Opacity="0.15" HorizontalOptions="Fill" VerticalOptions="Fill" />
                        
                        <BoxView Grid.RowSpan="2" BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                 Opacity="0.5" />
                        
                        <VerticalStackLayout Padding="20" Spacing="15">
                            <Label Text="Welcome to NexusChat" 
                                   FontFamily="OpenSansBold" FontSize="28" TextColor="White" />
                                   
                            <Label Text="Your hub for AI-powered conversation" 
                                   FontFamily="OpenSansRegular" FontSize="16" TextColor="White" />
                                   
                            <Button x:Name="StartNewChatButton"
                                    Text="Start a New Chat" 
                                    BackgroundColor="White" 
                                    TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                    FontAttributes="Bold"
                                    CornerRadius="20" 
                                    Margin="0,10,0,0"
                                    HorizontalOptions="Start" />
                        </VerticalStackLayout>
                    </Grid>
                </Frame>

                <!-- Quick Access Section -->
                <Label Text="Quick Access"
                       FontFamily="OpenSansBold"
                       FontSize="20"
                       TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}"
                       Margin="0,0,0,10" />

                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="15">
                    <!-- Chats Tab -->
                    <Frame x:Name="ChatsFrame" CornerRadius="8" Padding="15" HasShadow="True" Grid.Column="0"
                           BackgroundColor="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                            <Label Text="&#xf4ad;" Style="{StaticResource MainPageIcon}" />
                            <Label Text="Chats" FontFamily="OpenSansSemiBold" 
                                   TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}"
                                   HorizontalOptions="Center" FontSize="14" />
                        </VerticalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer x:Name="ChatsTabTap" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    
                    <!-- Models Tab -->
                    <Frame x:Name="ModelsFrame" CornerRadius="8" Padding="15" HasShadow="True" Grid.Column="1"
                           BackgroundColor="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                            <Label Text="&#xf085;" Style="{StaticResource MainPageIcon}" />
                            <Label Text="Models" FontFamily="OpenSansSemiBold" 
                                   TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}"
                                   HorizontalOptions="Center" FontSize="14" />
                        </VerticalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer x:Name="ModelsTabTap" />
                        </Frame.GestureRecognizers>
                    </Frame>
                    
                    <!-- Settings Tab -->
                    <Frame x:Name="SettingsFrame" CornerRadius="8" Padding="15" HasShadow="True" Grid.Column="2"
                           BackgroundColor="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                            <Label Text="&#xf013;" Style="{StaticResource MainPageIcon}" />
                            <Label Text="Settings" FontFamily="OpenSansSemiBold" 
                                   TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}"
                                   HorizontalOptions="Center" FontSize="14" />
                        </VerticalStackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer x:Name="SettingsTabTap" />
                        </Frame.GestureRecognizers>
                    </Frame>
                </Grid>

                <!-- Development Features Section -->
                <Label Text="Development Features"
                       FontFamily="OpenSansBold"
                       FontSize="20"
                       TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}"
                       Margin="0,20,0,10" />

                <Frame Padding="20" HasShadow="True" 
                       BackgroundColor="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="These features are available for testing and demonstration purposes." 
                               TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}" />
                        
                        <!-- Counter Button 
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                            <Label Grid.Column="0" Text="&#xf201;" 
                                   Style="{StaticResource MainPageIcon}" 
                                   VerticalOptions="Center" />
                            
                            <VerticalStackLayout Grid.Column="1">
                                <Label Text="Counter Demo" FontFamily="OpenSansSemiBold" FontSize="16" 
                                       TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}" />
                                <Label Text="Simple button click counter example" 
                                       TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}" FontSize="12" />
                            </VerticalStackLayout>
                            
                            <Button x:Name="CounterBtn" Grid.Column="2" 
                                    Text="Play Clicker Game" 
                                    Clicked="OnCounterClicked"
                                    Style="{StaticResource OutlineButton}" />
                        </Grid>

                        -->
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                            <Label Grid.Column="0" Text="&#xf201;" 
                                Style="{StaticResource MainPageIcon}" 
                                VerticalOptions="Center" />
                            <VerticalStackLayout Grid.Column="1">
                                <Label Text="Clicker Game" FontFamily="OpenSansSemiBold" FontSize="16" 
                                    TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}" />
                                <StackLayout Orientation="Horizontal" Spacing="5">
                                    <Label Text="High Score:" 
                                        TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}" 
                                        FontSize="12" />
                                    <Label Text="{Binding MaxComboScore}" 
                                        TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                        FontAttributes="Bold"
                                        FontSize="12" />
                                </StackLayout>
                            </VerticalStackLayout>

                            <Button x:Name="CounterBtn" 
                                    Grid.Column="2" 
                                    Text="Play!" 
                                    Clicked="OnCounterClicked"
                                    HeightRequest="50"
                                    WidthRequest="110"
                                    Padding="5"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    CornerRadius="25"
                                    Scale="1">
                                <Button.Shadow>
                                    <Shadow Brush="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                            Offset="0,2"
                                            Opacity="0.5"
                                            Radius="4"/>
                                </Button.Shadow>
                            </Button>
                        </Grid>

                        <BoxView HeightRequest="1" 
                                 BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" />
                        
                        <!-- Theme Testing - Updated to include icons -->
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                            <Label Grid.Column="0" Text="&#xf042;" 
                                   Style="{StaticResource MainPageIcon}" 
                                   VerticalOptions="Center" />
                            
                            <VerticalStackLayout Grid.Column="1">
                                <Label Text="Theme &amp; Icon Testing" FontFamily="OpenSansSemiBold" FontSize="16" 
                                       TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}" />
                                <Label Text="View theme components and icons reference" 
                                       TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}" FontSize="12" />
                            </VerticalStackLayout>
                            
                            <Button Grid.Column="2" 
                                    Text="{Binding ThemesButtonText}"
                                    IsEnabled="{Binding ThemesButtonEnabled}" 
                                    Clicked="ThemesBtn_Clicked"
                                    Style="{StaticResource OutlineButton}" />
                        </Grid>
                        
                        <BoxView HeightRequest="1" 
                                 BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" />
                        
                        <!-- NEW: Model Test Button -->
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                            <Label Grid.Column="0" Text="&#xf0ae;" 
                                   Style="{StaticResource MainPageIcon}" 
                                   VerticalOptions="Center" />
                            
                            <VerticalStackLayout Grid.Column="1">
                                <Label Text="Data Model Testing" FontFamily="OpenSansSemiBold" FontSize="16" 
                                       TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}" />
                                <Label Text="Run tests for data models and validate functionality" 
                                       TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}" FontSize="12" />
                            </VerticalStackLayout>
                            
                            <Button Grid.Column="2" 
                                    Text="Run Tests" 
                                    Clicked="ModelTestBtn_Clicked"
                                    BackgroundColor="{AppThemeBinding Light=#3a86ff, Dark=#4895ef}"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    CornerRadius="8" />
                        </Grid>

                        <BoxView HeightRequest="1" 
                                 BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" />
                        
                        <!-- Database Viewer Button -->
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                            <Label Grid.Column="0" Text="&#xf1c0;" 
                                   Style="{StaticResource MainPageIcon}" 
                                   VerticalOptions="Center" />
                            
                            <VerticalStackLayout Grid.Column="1">
                                <Label Text="Database Viewer" FontFamily="OpenSansSemiBold" FontSize="16" 
                                       TextColor="{AppThemeBinding Light={StaticResource PrimaryTextColor}, Dark={StaticResource PrimaryTextColorDark}}" />
                                <Label Text="View and explore database tables and records" 
                                       TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}" FontSize="12" />
                            </VerticalStackLayout>
                            
                            <Button Grid.Column="2" 
                                    Text="Open Database" 
                                    Clicked="DbViewerBtn_Clicked"
                                    BackgroundColor="{AppThemeBinding Light=#4361ee, Dark=#4895ef}"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    CornerRadius="8" />
                        </Grid>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Version Info -->
                <Label Text="NexusChat v1.0.0-dev" 
                       HorizontalOptions="Center"
                       TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}" 
                       FontSize="12" Margin="0,10,0,20" />
            </VerticalStackLayout>
        </ScrollView>
        
        <!-- Footer -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*,*" 
              BackgroundColor="{AppThemeBinding Light={StaticResource CardBackground}, Dark={StaticResource CardBackgroundDark}}" 
              HeightRequest="60" Padding="0">
              
            <Frame Grid.Column="0" BorderColor="Transparent" BackgroundColor="Transparent" 
                   Padding="0" Margin="15,5" CornerRadius="10" HasShadow="False" HorizontalOptions="Center">
                <Grid WidthRequest="60">
                    <BoxView CornerRadius="10" 
                             BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" 
                             Opacity="0.1" />
                    <Label Text="&#xf015;" 
                           Style="{StaticResource MainPageIcon}"
                           FontSize="20" />
                </Grid>
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer x:Name="HomeButton" />
                </Frame.GestureRecognizers>
            </Frame>
            
            <Frame Grid.Column="1" BorderColor="Transparent" BackgroundColor="Transparent"
                   Padding="0" Margin="15,5" CornerRadius="10" HasShadow="False" HorizontalOptions="Center">
                <Grid WidthRequest="60">
                    <BoxView CornerRadius="10" BackgroundColor="{StaticResource Gray200}" 
                             Opacity="0.1" />
                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="2">
                        <Label Text="&#xf304;" 
                               FontFamily="FontAwesome-Solid"
                               FontSize="18" 
                               FontAutoScalingEnabled="False"
                               TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}" />
                        <Label Text="Coming Soon" FontSize="8" 
                               TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Grid>
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer x:Name="NewChatButton" />
                </Frame.GestureRecognizers>
            </Frame>
            
            <Frame Grid.Column="2" BorderColor="Transparent" BackgroundColor="Transparent"
                   Padding="0" Margin="15,5" CornerRadius="10" HasShadow="False" HorizontalOptions="Center">
                <Grid WidthRequest="60">
                    <BoxView CornerRadius="10" BackgroundColor="{StaticResource Gray200}" 
                             Opacity="0.1" />
                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="2">
                        <Label Text="&#xf007;" 
                               FontFamily="FontAwesome-Solid"
                               FontSize="18" 
                               FontAutoScalingEnabled="False"
                               TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}" />
                        <Label Text="Coming Soon" FontSize="8" 
                               TextColor="{AppThemeBinding Light={StaticResource SecondaryTextColor}, Dark={StaticResource SecondaryTextColorDark}}"
                               HorizontalOptions="Center" />
                    </VerticalStackLayout>
                </Grid>
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer x:Name="ProfileButton" />
                </Frame.GestureRecognizers>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>
